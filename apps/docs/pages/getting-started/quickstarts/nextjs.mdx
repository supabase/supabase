import Layout from '~/layouts/DefaultGuideLayout'
import StepHikeCompact from '~/components/StepHikeCompact'

export const meta = {
  title: 'Install Supabase with NextJS',
  subtitle: 'Setting up supabase-js client library in a NextJS app.',
}

The fastest way to get started with supabase and NextJS is to use the supabase-js client library, which provides a convenient interface for working with supabase from a NextJS app. To use supabase-js with NextJS, you can follow these steps:

<StepHikeCompact>

  <StepHikeCompact.Step step={1}>

    <StepHikeCompact.Details title="Create a NextJS app">

    First, create a Next.js app using the create-next-app command:

    </StepHikeCompact.Details>

    <StepHikeCompact.Code>

      ```bash Terminal
      npx create-next-app my-app
      ```

    </StepHikeCompact.Code>

  </StepHikeCompact.Step>

  <StepHikeCompact.Step step={2}>
    <StepHikeCompact.Details title="Create create-react-app app">

      Next, we'll navigate into the new app directory and then install the supabase-js package.


    </StepHikeCompact.Details>

    <StepHikeCompact.Code>

      ```bash Terminal
      cd my-app
      npm install supabase-js
      ```

    </StepHikeCompact.Code>

  </StepHikeCompact.Step>

  <StepHikeCompact.Step step={3}>
    <StepHikeCompact.Details title="Create some sample data">

    To create a table of countries with their timezones, you will first need to create a table in your Supabase database using SQL. You can use the following SQL statement to create a table called countries:

    </StepHikeCompact.Details>

    <StepHikeCompact.Code>

     ```sql SQL_EDITOR
      -- this creates the table
      CREATE TABLE countries (
      id SERIAL PRIMARY KEY,
      name VARCHAR(255) NOT NULL
      );
      -- insert some sample data into new table
      INSERT INTO countries (name) VALUES ('United States');
      INSERT INTO countries (name) VALUES ('Canada');
      INSERT INTO countries (name) VALUES ('Mexico');
      ````

    </StepHikeCompact.Code>

  </StepHikeCompact.Step>

  <StepHikeCompact.Step step={3}>
    <StepHikeCompact.Details title="Start your app">

    This will create a new directory with the name you specified, and scaffold a new React project inside it. You can then navigate to the new project directory and start the dev server by running the following commands:

    </StepHikeCompact.Details>

    <StepHikeCompact.Code>

      ```bash Terminal
      cd my-app
      npm run dev
      ```

    </StepHikeCompact.Code>

  </StepHikeCompact.Step>

  <StepHikeCompact.Step step={6}>
    <StepHikeCompact.Details title="Create client in app">

    Next, in your Next.js app, create a file called supabase-client.js and add the following code to initialize the Supabase client and set your project's credentials:

    </StepHikeCompact.Details>

    <StepHikeCompact.Code>

      ```js lib/supabaseClient.js
        import { createClient } from '@supabase/supabase-js'

        const supabase = createClient('https://xyzcompany.supabase.co', 'public-anon-key')
      ```

    </StepHikeCompact.Code>

  </StepHikeCompact.Step>

  <StepHikeCompact.Step step={7}>
    <StepHikeCompact.Details title="Create ">

    Now, you can query the countries table using the supabase-js client in your Next.js app. For example, you could use a getInitialProps method to fetch the data when your page loads:

    </StepHikeCompact.Details>

    <StepHikeCompact.Code>

      ```js app/index.js
        import { supabase } from './../lib/supabaseClient';

        function Page({ countries }) {
          return (
            <ul>
              {countries.map((country) => (
                <li key={country.id}>{country.name}</li>
              ))}
            </ul>
          );
        }

        Page.getInitialProps = async () => {
          const { data, error } = await supabase.from('countries').select()

          return {
            countries: data
          }
        }

        export default Page;
      ```

    </StepHikeCompact.Code>

  </StepHikeCompact.Step>

</StepHikeCompact>

export const Page = ({ children }) => <Layout meta={meta} children={children} />
export default Page
