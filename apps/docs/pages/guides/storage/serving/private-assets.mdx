import Layout from '~/layouts/DefaultGuideLayout'

export const meta = {
  id: 'storage-serving-public-assets',
  title: 'Serving Private Assets',
  description: 'Learn how to serve Supabase Storage private assets.',
  sidebar_label: 'Serving',
}

Assets stored in a non-public bucket are considered private and are not accessible via a public url like the public buckets.

You can access them only by:

- Signing a time limited URL on the Server, for example with Edge Functions.
- with a GET request the url `https://[project_id].supabase.co/storage/v1/authenticated/[bucket]/[asset-name]` and the user Authorization header

### Signing URLs

You can sign a time-limited URL that you can share to your users by invoking the `createSignedUrl` method on the SDK.

```js
const { data, error } = supabase.storage
  .from('bucket')
  .createSignedUrl('private-document.pdf', 3600)

if (data) {
  console.log(data.signedUrl)
}
```

### Access Control

If want your users to be able to fetch an asset from the url `https://[project_id].supabase.co/storage/v1/authenticated/[bucket]/[asset-name]` and provide granular RLS policies to determine the access, you will need grant the `SELECT` action to your RLS policy

#### Allowing individual access

Allow a user to access a file that was previously uploaded by the same user:

```sql
create policy "Individual user Access"
on storage.objects for select
to authenticated
using ( auth.uid() = owner_id );
```

---

{/* Finish with a video. This also appears in the Sidebar via the "tocVideo" metadata */}

<div className="video-container">
  <iframe
    src="https://www.youtube-nocookie.com/embed/4ERX__Y908k"
    frameBorder="1"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
    allowFullScreen
  ></iframe>
</div>

export const Page = ({ children }) => <Layout meta={meta} children={children} />

export default Page
