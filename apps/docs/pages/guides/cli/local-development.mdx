import Layout from '~/layouts/DefaultGuideLayout'

export const meta = {
  id: 'local-development',
  title: 'Local Development',
  description: 'How to use Supabase on your local development machine.',
  video: 'https://www.youtube.com/v/vyHyYpvjaks',
}

Once you've moved beyond the initial "clicking around" stage and are ready to start building your project, we suggest following a workflow that involves working locally and deploying your changes to a linked project on the [Supabase Platform](https://app.supabase.io/).

Doing things directly on the platform via the [Dashboard](https://app.supabase.io/) is fine when you're getting started, but it's a good idea to move to a proper local workflow before you get too far. We'll get into all of the details, but the gist is that you'll work locally, generate migrations as you change your tables, and apply those migrations to a linked project on the [Platform](https://app.supabase.io/).

## Why develop locally?

The Dashboard provides a wide range of features for setting up your project: creating tables, adding columns, changing existing columns, creating views, and more. Given all of the Dashboard's capabilities, you might question the need to work locally. Here's a few advantages to working this way:

1. **Faster Development**: Developing your project locally allows you to work without any network latency or internet disruptions.

2. **Easier Collaboration**: Developing your project locally can make it easier to collaborate with others on the same project.

3. **Cost-Effective**: While Supabase provides a generous free tier and gives you two free projects to get started, you may be working on many projects at once. Developing locally means that you can spin up unlimited projects locally and only link them with live projects when you're ready to launch.

4. **Configuration in code**: If you directly change your tables via the Dashboard, none of that is captured in code. If you follow these local development practices, you'll store all of your table schemas in code.

5. **Work offline**: Need to work from a train? A plain? An automobile? No problem. Developing your project locally allows you to work offline.

<div className="video-container">
  <iframe
    src="https://www.youtube-nocookie.com/embed/vyHyYpvjaks"
    frameBorder="1"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
    allowFullScreen
  ></iframe>
</div>

## Prerequisites

Make sure you have these installed on your local machine:

- [Docker](https://docs.docker.com/engine/install/)
- [Git](https://github.com/git-guides/install-git)
- [Supabase CLI](/docs/guides/cli)

## Log in to the Supabase CLI

```bash
supabase login
```

<Admonition type="note">

If you installed the Supabase CLI via NPM you may have to use `npx supabase login`.

</Admonition>

## Initialize your project

Create a new folder for your project and start a new git repository:

```bash
# create your project folder
mkdir your-project

# move into the new folder
cd your-project

# start a new git repository — important, don't skip this step
git init
```

## Start Supabase services

[Initialize](/docs/reference/cli/usage#supabase-init) Supabase to set up the configuration for developing your project locally:

```bash
supabase init
```

Make sure Docker is running. The [start](/docs/reference/cli/usage#supabase-start) command uses Docker to start the Supabase [services](/docs/guides/getting-started/architecture).
This command may take a while to run if this is the first time using the CLI.

```bash
supabase start
```

Once all of the Supabase services are running, you'll see output containing your local Supabase credentials. It should look like this, with urls and keys that you'll use in your local project:

```

Started supabase local development setup.

         API URL: http://localhost:54321
          DB URL: postgresql://postgres:postgres@localhost:54322/postgres
      Studio URL: http://localhost:54323
    Inbucket URL: http://localhost:54324
        anon key: eyJh......
service_role key: eyJh......

```

You can use the [supabase stop](/docs/reference/cli/usage#supabase-stop) command at any time to stop all services.

## Access your project's services

You can access these services directly with any Postgres client or through the API Gateway ([Kong](https://github.com/Kong/kong)).

<Tabs
  scrollable
  size="small"
  type="underlined"
  defaultActiveId="postgres"
>
<TabPanel id="postgres" label="Postgres">

```sh
# Default URL:
postgresql://postgres:postgres@localhost:54322/postgres
```

The local Postgres instance can be accessed through [`psql`](https://www.postgresql.org/docs/current/app-psql.html)
or any other Postgres client, such as [pgadmin](https://www.pgadmin.org/).

For example:

```bash
psql 'postgresql://postgres:postgres@localhost:54322/postgres'
```

<Admonition type="note">

To access the database from an edge function in your local Supabase setup, replace `localhost` with `host.docker.internal`.

</Admonition>

</TabPanel>
<TabPanel id="kong" label="API Gateway">

```sh
# Default URL:
http://localhost:54321
```

If you are accessing these services without the client libraries, you may need to pass the client keys as an `Authorization` header.
Learn more about [JWT headers](/docs/learn/auth-deep-dive/auth-deep-dive-jwts).

```sh
curl 'http://localhost:54321/rest/v1/' \
    -H "apikey: <anon key>" \
    -H "Authorization: Bearer <anon key>"

http://localhost:54321/rest/v1/           # REST (PostgREST)
http://localhost:54321/realtime/v1/       # Realtime
http://localhost:54321/storage/v1/        # Storage
http://localhost:54321/auth/v1/           # Auth (GoTrue)
```

<Admonition type="note">

`<anon key>` is provided when you run the command `supabase start`.

</Admonition>

</TabPanel>
</Tabs>

## Database migrations

Database changes are managed through "migrations." Database migrations are a common way of tracking changes to your database over time.

<div className="video-container">
  <iframe
    src="https://www.youtube-nocookie.com/embed/Kx5nHBmIxyQ"
    frameBorder="1"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
    allowFullScreen
  ></iframe>
</div>

### Make database changes

For this guide, we'll create a table called `employees` and see how we can make changes to it.

To get started, generate a [new migration](https://supabase.com/docs/reference/cli/supabase-migration-new) to store the SQL needed to create our `employees` table:

```bash
supabase migration new create_employees_table
```

This creates a new migration named `supabase/migrations/<timestamp>_create_employees_table.sql`. To that file, add the SQL to create this `employees` table:

```sql
create table
  employees (
    id integer primary key generated always as identity,
    name text
  );
```

Now that we have a migration file, we can run this migration and create our `employees` table. We use the `reset` command here to reset the database to the current migrations:

```bash
supabase db reset
```

Now you can visit your new `employees` table in the Dashboard.

Next, let's modify our `employees` table by adding a column for department. Let's create a new migration file for that:

```bash
supabase migration new add_department_to_employees_table
```

This creates a new migration named `supabase/migrations/<timestamp>_add_department_to_employees_table.sql`. To that file, add the SQL to create a new department column:

```sql
alter table
  if exists public.employees add department text default 'Hooli';
```

### Add sample data

Use the seed script in `supabase/seed.sql` (created with [`supabase init`](/docs/reference/cli/usage#supabase-init)) to add sample data to the table.

```sql
 -- in supabase/seed.sql
insert into
  public.employees (name)
values
  ('Erlich Bachman'),
  ('Richard Hendricks'),
  ('Monica Hall');
```

Rerun the migration and seed scripts:

```bash
supabase db reset
```

You should now see the contents of `employees` in Studio. All of your database changes are captured in code, and you can reset to a known state at any time, complete with seed data.

## Deploy your project

Go to the [Supabase Dashboard](https://app.supabase.com) and create a project to deploy the changes.

### Link your project

<Admonition type="note">

There are a few commands required to link your project. We are in the process of consolidating these commands into a single command. Bear with us!

</Admonition>

Associate your project with your remote project using [`supabase link`](/docs/reference/cli/usage#supabase-link).

```bash
supabase link --project-ref <project-id>
# You can get <project-id> from your project’s dashboard URL: https://app.supabase.com/project/<project-id>

supabase db remote commit
# Capture any changes that you have made to your database before setting up the CLI
```

`supabase/migrations` is now populated with a migration in `..._remote_commit.sql`.
This migration captures any changes required for your local database to match the schema of your remote Supabase project.

### Deploy database changes

Deploy any local database migrations using [`db push`](/docs/reference/cli/usage#supabase-db-push):

```sh
supabase db push
```

### Deploy Edge Functions

Deploy any Edge Functions using [`functions deploy`](/docs/reference/cli/usage#supabase-functions-deploy):

```sh
supabase functions deploy <function_name>
```

## Limitations

The local development environment is not as feature-complete as the Supabase Platform. Here are some of the differences:

- The Functions interface is coming soon.
- Logs are not supported through the interface (however you can access them through the Docker containers).
- You cannot update your project settings in the Dashboard—this must be done using the CLI.

export const Page = ({ children }) => <Layout meta={meta} children={children} />

export default Page
