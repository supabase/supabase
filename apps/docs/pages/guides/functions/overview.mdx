import Layout from '~/layouts/DefaultGuideLayout'

export const meta = {
  id: 'functions-overview',
  title: 'Edge Functions Overview',
  description: 'Globally distributed TypeScript Functions.',
  sidebar_label: 'Overview',
}

Learn how to build an Edge Function locally and deploy it to the Supabase Platform in less than 7 minutes.

<div className="video-container">
  <iframe
    src="https://www.youtube-nocookie.com/embed/rzglqRdZUQE"
    frameBorder="1"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
    allowFullScreen
  ></iframe>
</div>

## Prerequisites

Follow the steps to prepare your Supabase project on your local machine.

- Install the Supabase CLI. [Docs](/docs/guides/cli).
- Login to the CLI using the command: `supabase login`. [Docs](/docs/reference/cli/usage#supabase-login).
- Initialize Supabase inside your project using the command: `supabase init`. [Docs](/docs/guides/cli/local-development#getting-started).
- Link to your Remote Project using the command `supabase link --project-ref your-project-ref`. [Docs](/docs/reference/cli/usage#supabase-link).
- Optional: Setup your environment: Follow [this setup guide](https://deno.land/manual/getting_started/setup_your_environment) to integrate the Deno language server with your editor.

## Create a function

Let's create a new Edge Function called `hello-world` inside your project:

```bash
supabase functions new hello-world
```

This creates a function stub in your `supabase` folder at `./functions/hello-world/index.ts`.

## Deploy to production

```bash
supabase functions deploy hello-world
```

This command bundles your Edge Function from `./functions/hello-world/index.ts` and deploys it to the Supabase platform.
The command outputs a URL to the Supabase Dashboard which you can open to find view more details. Let's open the link to find the execution command.

<Admonition type="note">

By default, Edge Functions require a valid JWT in the authorization header. This header is automatically set when invoking your function via a Supabase client library.

If you want to use Edge Functions to handle webhooks (e.g. [Stripe payment webhooks](https://github.com/supabase/supabase/tree/master/examples/edge-functions/supabase/functions/stripe-webhooks) etc.), you need to pass the `--no-verify-jwt` flag when deploying your function.

</Admonition>

## Execute remote functions

You can execute Edge Functions using curl. Copy the curl command from the Dashboard. It should look like this:

```bash
curl --request POST 'https://<project_ref>.functions.supabase.co/hello-world' \
  --header 'Authorization: Bearer ANON_KEY' \
  --header 'Content-Type: application/json' \
  --data '{ "name":"Functions" }'
```

If you receive an error `Invalid JWT`, find the `ANON_KEY` of your project in the Dashboard under `Settings > API`.

After invoking your Edge Function you should see the response `{ "message":"Hello Functions!" }`.

## Limitations

- Deno Deploy limitations
  - Deno does not support outgoing connections to ports `25`, `465`, and `587`.
  - Cannot write to File System
- Edge Functions
  - Local development - only one function at a time
  - Serving of HTML content is not supported (`GET` requests that return `text/html` will be rewritten to `text/plain`).

export const Page = ({ children }) => <Layout meta={meta} children={children} />

export default Page
