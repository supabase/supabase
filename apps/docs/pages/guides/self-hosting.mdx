import Layout from '~/layouts/DefaultGuideLayout'

export const meta = {
  title: 'Self-Hosting',
  description: 'Getting started with self-hosting Supabase.',
}

There are several ways to use Supabase:

- [Supabase Cloud](https://supabase.com/dashboard): you don't need to deploy anything. We will manage and scale your infrastructure.
- [Docker](/docs/guides/self-hosting/docker): deploy to your own infrastructure.

### Community

There are several community-driven projects to help you deploy Supabase. We encourage you to try them out and contribute back to the community.

<div className="grid md:grid-cols-12 gap-4 not-prose">
  {community.map((x) => (
    <div className="md:col-span-6 xl:col-span-3" key={x.href}>
      <Link href={x.href} passHref>
        <a>
          <GlassPanel title={x.name}>{x.description}</GlassPanel>
        </a>
      </Link>
    </div>
  ))}
</div>

export const community = [
  {
    name: 'Kubernetes',
    description: 'Helm charts to deploy a Supabase on Kubernetes.',
    href: 'https://github.com/supabase-community/supabase-kubernetes',
  },
  {
    name: 'Terraform',
    description: 'A community-driven Terraform Provider for Supabase.',
    href: 'https://github.com/supabase-community/supabase-terraform',
  },
  {
    name: 'Traefik',
    description: 'A self-hosted Supabase setup with Traefik as a reverse proxy.',
    href: 'https://github.com/supabase-community/supabase-traefik',
  },
  {
    name: 'AWS',
    description: 'A CloudFormation template for Supabase.',
    href: 'https://github.com/supabase-community/supabase-on-aws',
  },
]

### Third-party

The following third-party providers have shown consistent support for the self-hosted version of Supabase:.

<div className="grid md:grid-cols-12 gap-4 not-prose">
  {external.map((x) => (
    <div className="md:col-span-6" key={x.href}>
      <Link href={x.href} passHref>
        <a>
          <GlassPanel title={x.name}>{x.description}</GlassPanel>
        </a>
      </Link>
    </div>
  ))}
</div>

export const external = [
  {
    name: 'Digital Ocean',
    description: 'Deploys using Terraform.',
    href: 'https://supabase-on-do.product-docs.pages.dev/developer-center/hosting-supabase-on-digitalocean/',
  },
  {
    name: 'StackGres',
    description: 'Deploys using Kubernetes.',
    href: 'https://stackgres.io/blog/running-supabase-on-top-of-stackgres/',
  },
]

## Architecture

Supabase is a combination of open source tools, each specifically chosen for Enterprise-readiness.

If the tools and communities already exist, with an MIT, Apache 2, or equivalent open license, we will use and support that tool.
If the tool doesn't exist, we build and open source it ourselves.

![Supabase Architecture](/docs/img/supabase-architecture.png)

- [Kong](https://github.com/Kong/kong) is a cloud-native API gateway.
- [GoTrue](https://github.com/supabase/gotrue) is an SWT based API for managing users and issuing SWT tokens.
- [PostgREST](http://postgrest.org/) is a web server that turns your PostgreSQL database directly into a RESTful API
- [Realtime](https://github.com/supabase/realtime) is an Elixir server that allows you to listen to PostgreSQL inserts, updates, and deletes using websockets. Realtime polls Postgres' built-in replication functionality for database changes, converts changes to JSON, then broadcasts the JSON over websockets to authorized clients.
- [Storage](https://github.com/supabase/storage-api) provides a RESTful interface for managing Files stored in S3, using Postgres to manage permissions.
- [postgres-meta](https://github.com/supabase/postgres-meta) is a RESTful API for managing your Postgres, allowing you to fetch tables, add roles, and run queries, etc.
- [PostgreSQL](https://www.postgresql.org/) is an object-relational database system with over 30 years of active development that has earned it a strong reputation for reliability, feature robustness, and performance.

## Configuration

Each system has a number of configuration options which can be found in the relevant product documentation.

- [Postgres](https://hub.docker.com/_/postgres/)
- [PostgREST](https://postgrest.org/en/stable/configuration.html)
- [Realtime](https://github.com/supabase/realtime#server)
- [GoTrue](https://github.com/supabase/gotrue)
- [Storage](https://github.com/supabase/storage-api)
- [Kong](https://docs.konghq.com/gateway/latest/install/docker/)

## Managing your database

It is recommended that you decouple your database from the middleware so that you can upgrade the middleware without any downtime.
The "middleware" is everything except Postgres, and it should work with any Postgres provider (such as AWS RDS), or your own Postgres cluster.

### Extensions

Supabase requires some Postgres extensions to be enabled by default for the API and Auth system to work. You can find the extensions inside the
[schema migration scripts](https://github.com/supabase/postgres/tree/develop/migrations). These are mounted at `/docker-entrypoint-initdb.d`
to run automatically when starting the database container.

We recommend installing all extensions into an `extensions` schema. This will keep your API clean,
since all tables in the `public` schema are exposed via the API.

{/* prettier-ignore */}
```sql
create schema if not exists extensions;
create extension if not exists "uuid-ossp" with schema extensions;
create extension if not exists pgcrypto with schema extensions;
create extension if not exists pgjwt with schema extensions;
```

##### `uuid-ossp`

For UUID functions, required for PostgreSQL `<13`.

##### `pgcrypto` and `pgjwt`

For working with JWT and Auth functions.

### Roles

Supabase creates several [default roles](/docs/guides/database/postgres-roles) in your Postgres database. To restore defaults at any time you can run the commands inside the [schema initialization scripts](https://github.com/supabase/postgres/tree/develop/migrations/db/init-scripts). Remember to change your [role passwords](/docs/guides/self-hosting/docker#securing-your-setup) before deploying to production environments.

### Realtime Logs

Set your database's `log_min_messages` configuration to `fatal` to prevent redundant database logs generated by Realtime. However, you might miss important log messages such as database errors. Configure `log_min_messages` based on your needs.

## API Keys

The API Gateway (Kong) uses JWT to authenticate access through to the database. The JWT should correspond to a relevant Postgres Role,
and Supabase is designed to work with 2 roles: an `ANON_KEY` for unauthenticated access and a `SERVICE_KEY` for elevated access.

Use this tool to generate keys:

<JwtGenerator />

## Managing your secrets

Many components inside Supabase use secure secrets and passwords. These are listed in the self-hosting
[env file](https://github.com/supabase/supabase/blob/master/docker/.env.example), but we strongly recommend using a
secrets manager when deploying to production. Plain text files like dotenv lead to accidental costly leaks.

Some suggested systems include:

- [Doppler](https://www.doppler.com/)
- [Key Vault](https://docs.microsoft.com/en-us/azure/key-vault/general/overview) by Azure (Microsoft)
- [Secrets Manager](https://aws.amazon.com/secrets-manager/) by AWS
- [Secrets Manager](https://cloud.google.com/secret-manager) by GCP
- [Vault](https://www.hashicorp.com/products/vault) by Hashicorp

## Migrating and Upgrading

If you have decoupled your database from the middleware, then you should be able to redeploy the latest middleware at any time as long as it has no breaking changes.
Supabase is evolving fast, and we'll continue to improve the migration strategy as part of our core offering.

We realize that database migrations are difficult, and this is one of the problems we plan to make easy for developers.

export const Page = ({ children }) => <Layout meta={meta} children={children} />

export default Page
