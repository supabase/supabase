{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "passwordless-auth-nextjs",
  "type": "registry:block",
  "title": "Passwordless Auth for Next.js and Supabase",
  "description": "Passwordless authentication for Next.js using Supabase Auth. Supports both Magic Link and OTP (One-Time Password) login methods.",
  "dependencies": [
    "@supabase/ssr@latest",
    "@supabase/supabase-js@latest"
  ],
  "registryDependencies": [
    "button",
    "card",
    "input",
    "label"
  ],
  "files": [
    {
      "path": "registry/default/blocks/passwordless-auth-nextjs/components/magic-link-form.tsx",
      "content": "'use client'\n\nimport { cn } from '@/lib/utils'\nimport { createClient } from '@/registry/default/clients/nextjs/lib/supabase/client'\nimport { Button } from '@/registry/default/components/ui/button'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/registry/default/components/ui/card'\nimport { Input } from '@/registry/default/components/ui/input'\nimport { Label } from '@/registry/default/components/ui/label'\nimport { useState } from 'react'\n\nexport function MagicLinkForm({ className, ...props }: React.ComponentPropsWithoutRef<'div'>) {\n  const [email, setEmail] = useState('')\n  const [error, setError] = useState<string | null>(null)\n  const [isLoading, setIsLoading] = useState(false)\n  const [isSuccess, setIsSuccess] = useState(false)\n\n  const handleMagicLinkRequest = async (e: React.FormEvent) => {\n    e.preventDefault()\n    const supabase = createClient()\n    setIsLoading(true)\n    setError(null)\n    setIsSuccess(false)\n\n    try {\n      const { error } = await supabase.auth.signInWithOtp({\n        email,\n        options: {\n          // Set this to false if you do not want the user to be automatically signed up\n          shouldCreateUser: true,\n          emailRedirectTo: `${window.location.origin}/auth/confirm`,\n        },\n      })\n      if (error) throw error\n      setIsSuccess(true)\n    } catch (error: unknown) {\n      setError(error instanceof Error ? error.message : 'An error occurred')\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <div className={cn('flex flex-col gap-6', className)} {...props}>\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-2xl\">Magic Link Login</CardTitle>\n          <CardDescription>\n            Enter your email to receive a magic link for passwordless login\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isSuccess ? (\n            <div className=\"rounded-lg border border-green-200 bg-green-50 p-4 text-sm text-green-800\">\n              <p className=\"font-semibold\">Check your email!</p>\n              <p className=\"mt-1\">\n                We&apos;ve sent a magic link to <span className=\"font-medium\">{email}</span>. Click\n                the link in the email to sign in.\n              </p>\n            </div>\n          ) : (\n            <form onSubmit={handleMagicLinkRequest}>\n              <div className=\"flex flex-col gap-6\">\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"email\">Email</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    placeholder=\"m@example.com\"\n                    required\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    disabled={isLoading}\n                  />\n                </div>\n                {error && <p className=\"text-sm text-red-500\">{error}</p>}\n                <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\n                  {isLoading ? 'Sending magic link...' : 'Send magic link'}\n                </Button>\n              </div>\n            </form>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/blocks/passwordless-auth-nextjs/components/otp-request-form.tsx",
      "content": "'use client'\n\nimport { cn } from '@/lib/utils'\nimport { createClient } from '@/registry/default/clients/nextjs/lib/supabase/client'\nimport { Button } from '@/registry/default/components/ui/button'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/registry/default/components/ui/card'\nimport { Input } from '@/registry/default/components/ui/input'\nimport { Label } from '@/registry/default/components/ui/label'\nimport { useRouter } from 'next/navigation'\nimport { useState } from 'react'\n\nexport function OTPRequestForm({ className, ...props }: React.ComponentPropsWithoutRef<'div'>) {\n  const [email, setEmail] = useState('')\n  const [error, setError] = useState<string | null>(null)\n  const [isLoading, setIsLoading] = useState(false)\n  const router = useRouter()\n\n  const handleOTPRequest = async (e: React.FormEvent) => {\n    e.preventDefault()\n    const supabase = createClient()\n    setIsLoading(true)\n    setError(null)\n\n    try {\n      const { error } = await supabase.auth.signInWithOtp({\n        email,\n        options: {\n          // Set this to false if you do not want the user to be automatically signed up\n          shouldCreateUser: true,\n        },\n      })\n      if (error) throw error\n      // Navigate to OTP verification page\n      router.push(`/auth/verify-otp?email=${encodeURIComponent(email)}`)\n    } catch (error: unknown) {\n      setError(error instanceof Error ? error.message : 'An error occurred')\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <div className={cn('flex flex-col gap-6', className)} {...props}>\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-2xl\">OTP Login</CardTitle>\n          <CardDescription>\n            Enter your email to receive a one-time password for passwordless login\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleOTPRequest}>\n            <div className=\"flex flex-col gap-6\">\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"email\">Email</Label>\n                <Input\n                  id=\"email\"\n                  type=\"email\"\n                  placeholder=\"m@example.com\"\n                  required\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  disabled={isLoading}\n                />\n              </div>\n              {error && <p className=\"text-sm text-red-500\">{error}</p>}\n              <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\n                {isLoading ? 'Sending code...' : 'Send verification code'}\n              </Button>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/blocks/passwordless-auth-nextjs/components/otp-verify-form.tsx",
      "content": "'use client'\n\nimport { cn } from '@/lib/utils'\nimport { createClient } from '@/registry/default/clients/nextjs/lib/supabase/client'\nimport { Button } from '@/registry/default/components/ui/button'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/registry/default/components/ui/card'\nimport { Input } from '@/registry/default/components/ui/input'\nimport { Label } from '@/registry/default/components/ui/label'\nimport { useRouter, useSearchParams } from 'next/navigation'\nimport { useState } from 'react'\n\nexport function OTPVerifyForm({ className, ...props }: React.ComponentPropsWithoutRef<'div'>) {\n  const searchParams = useSearchParams()\n  const email = searchParams.get('email') || ''\n  const [otp, setOTP] = useState('')\n  const [error, setError] = useState<string | null>(null)\n  const [isLoading, setIsLoading] = useState(false)\n  const [isResending, setIsResending] = useState(false)\n  const router = useRouter()\n\n  const handleVerifyOTP = async (e: React.FormEvent) => {\n    e.preventDefault()\n    const supabase = createClient()\n    setIsLoading(true)\n    setError(null)\n\n    try {\n      const { error } = await supabase.auth.verifyOtp({\n        email,\n        token: otp,\n        type: 'email',\n      })\n      if (error) throw error\n      // Redirect to protected page after successful verification\n      router.push('/protected')\n    } catch (error: unknown) {\n      setError(error instanceof Error ? error.message : 'An error occurred')\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  const handleResendOTP = async () => {\n    const supabase = createClient()\n    setIsResending(true)\n    setError(null)\n\n    try {\n      const { error } = await supabase.auth.signInWithOtp({\n        email,\n        options: {\n          shouldCreateUser: false,\n        },\n      })\n      if (error) throw error\n      setError(null)\n      // Show success message\n      alert('A new verification code has been sent to your email.')\n    } catch (error: unknown) {\n      setError(error instanceof Error ? error.message : 'Failed to resend code')\n    } finally {\n      setIsResending(false)\n    }\n  }\n\n  return (\n    <div className={cn('flex flex-col gap-6', className)} {...props}>\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-2xl\">Verify Your Email</CardTitle>\n          <CardDescription>\n            Enter the 6-digit code sent to{' '}\n            <span className=\"font-medium text-foreground\">{email}</span>\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <form onSubmit={handleVerifyOTP}>\n            <div className=\"flex flex-col gap-6\">\n              <div className=\"grid gap-2\">\n                <Label htmlFor=\"otp\">Verification Code</Label>\n                <Input\n                  id=\"otp\"\n                  type=\"text\"\n                  placeholder=\"123456\"\n                  required\n                  maxLength={6}\n                  pattern=\"[0-9]{6}\"\n                  value={otp}\n                  onChange={(e) => setOTP(e.target.value.replace(/\\D/g, ''))}\n                  disabled={isLoading}\n                  className=\"text-center text-2xl tracking-widest\"\n                />\n                <p className=\"text-xs text-muted-foreground\">Enter the 6-digit code</p>\n              </div>\n              {error && <p className=\"text-sm text-red-500\">{error}</p>}\n              <Button type=\"submit\" className=\"w-full\" disabled={isLoading || otp.length !== 6}>\n                {isLoading ? 'Verifying...' : 'Verify Code'}\n              </Button>\n              <div className=\"text-center text-sm\">\n                Didn&apos;t receive a code?{' '}\n                <button\n                  type=\"button\"\n                  onClick={handleResendOTP}\n                  disabled={isResending}\n                  className=\"text-primary underline-offset-4 hover:underline disabled:opacity-50\"\n                >\n                  {isResending ? 'Sending...' : 'Resend'}\n                </button>\n              </div>\n            </div>\n          </form>\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/blocks/passwordless-auth-nextjs/components/passwordless-login-form.tsx",
      "content": "'use client'\n\nimport { cn } from '@/lib/utils'\nimport { createClient } from '@/registry/default/clients/nextjs/lib/supabase/client'\nimport { Button } from '@/registry/default/components/ui/button'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/registry/default/components/ui/card'\nimport { Input } from '@/registry/default/components/ui/input'\nimport { Label } from '@/registry/default/components/ui/label'\nimport { useRouter } from 'next/navigation'\nimport { useState } from 'react'\n\ntype LoginMethod = 'magic-link' | 'otp'\n\ninterface PasswordlessLoginFormProps extends React.ComponentPropsWithoutRef<'div'> {\n  method?: LoginMethod\n}\n\nexport function PasswordlessLoginForm({\n  className,\n  method = 'magic-link',\n  ...props\n}: PasswordlessLoginFormProps) {\n  const [email, setEmail] = useState('')\n  const [error, setError] = useState<string | null>(null)\n  const [isLoading, setIsLoading] = useState(false)\n  const [isMagicLinkSent, setIsMagicLinkSent] = useState(false)\n  const router = useRouter()\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    const supabase = createClient()\n    setIsLoading(true)\n    setError(null)\n    setIsMagicLinkSent(false)\n\n    try {\n      if (method === 'magic-link') {\n        const { error } = await supabase.auth.signInWithOtp({\n          email,\n          options: {\n            shouldCreateUser: true,\n            emailRedirectTo: `${window.location.origin}/auth/confirm`,\n          },\n        })\n        if (error) throw error\n        setIsMagicLinkSent(true)\n      } else {\n        // OTP method\n        const { error } = await supabase.auth.signInWithOtp({\n          email,\n          options: {\n            shouldCreateUser: true,\n          },\n        })\n        if (error) throw error\n        // Navigate to OTP verification page\n        router.push(`/auth/verify-otp?email=${encodeURIComponent(email)}`)\n      }\n    } catch (error: unknown) {\n      setError(error instanceof Error ? error.message : 'An error occurred')\n    } finally {\n      setIsLoading(false)\n    }\n  }\n\n  return (\n    <div className={cn('flex flex-col gap-6', className)} {...props}>\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-2xl\">Sign up</CardTitle>\n          <CardDescription>Sign in or create a new account</CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isMagicLinkSent ? (\n            <div className=\"rounded-lg border border-green-200 bg-green-50 p-4 text-sm text-green-800\">\n              <p className=\"font-semibold\">Check your email!</p>\n              <p className=\"mt-1\">\n                We&apos;ve sent a magic link to <span className=\"font-medium\">{email}</span>. Click\n                the link in the email to sign in.\n              </p>\n              <Button\n                variant=\"outline\"\n                className=\"mt-4 w-full\"\n                onClick={() => {\n                  setIsMagicLinkSent(false)\n                  setEmail('')\n                }}\n              >\n                Send another link\n              </Button>\n            </div>\n          ) : (\n            <form onSubmit={handleSubmit}>\n              <div className=\"flex flex-col gap-6\">\n                <div className=\"grid gap-2\">\n                  <Label htmlFor=\"email\">Email</Label>\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    placeholder=\"m@example.com\"\n                    required\n                    value={email}\n                    onChange={(e) => setEmail(e.target.value)}\n                    disabled={isLoading}\n                  />\n                </div>\n                {error && <p className=\"text-sm text-red-500\">{error}</p>}\n                <Button type=\"submit\" className=\"w-full\" disabled={isLoading}>\n                  {isLoading\n                    ? method === 'magic-link'\n                      ? 'Sending magic link...'\n                      : 'Sending code...'\n                    : method === 'magic-link'\n                      ? 'Send magic link'\n                      : 'Send verification code'}\n                </Button>\n              </div>\n            </form>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/blocks/passwordless-auth-nextjs/app/auth/magic-link/page.tsx",
      "content": "import { MagicLinkForm } from '@/registry/default/blocks/passwordless-auth-nextjs/components/magic-link-form'\n\nexport default function MagicLinkPage() {\n  return (\n    <div className=\"flex min-h-svh w-full items-center justify-center p-6 md:p-10\">\n      <div className=\"w-full max-w-sm\">\n        <MagicLinkForm />\n      </div>\n    </div>\n  )\n}\n",
      "type": "registry:page",
      "target": "app/auth/magic-link/page.tsx"
    },
    {
      "path": "registry/default/blocks/passwordless-auth-nextjs/app/auth/otp/page.tsx",
      "content": "import { OTPRequestForm } from '@/registry/default/blocks/passwordless-auth-nextjs/components/otp-request-form'\n\nexport default function OTPRequestPage() {\n  return (\n    <div className=\"flex min-h-svh w-full items-center justify-center p-6 md:p-10\">\n      <div className=\"w-full max-w-sm\">\n        <OTPRequestForm />\n      </div>\n    </div>\n  )\n}\n",
      "type": "registry:page",
      "target": "app/auth/otp/page.tsx"
    },
    {
      "path": "registry/default/blocks/passwordless-auth-nextjs/app/auth/verify-otp/page.tsx",
      "content": "import { OTPVerifyForm } from '@/registry/default/blocks/passwordless-auth-nextjs/components/otp-verify-form'\nimport { Suspense } from 'react'\n\nfunction OTPVerifyContent() {\n  return (\n    <div className=\"flex min-h-svh w-full items-center justify-center p-6 md:p-10\">\n      <div className=\"w-full max-w-sm\">\n        <OTPVerifyForm />\n      </div>\n    </div>\n  )\n}\n\nexport default function OTPVerifyPage() {\n  return (\n    <Suspense fallback={<div>Loading...</div>}>\n      <OTPVerifyContent />\n    </Suspense>\n  )\n}\n",
      "type": "registry:page",
      "target": "app/auth/verify-otp/page.tsx"
    },
    {
      "path": "registry/default/blocks/passwordless-auth-nextjs/app/auth/passwordless/page.tsx",
      "content": "import { PasswordlessLoginForm } from '@/registry/default/blocks/passwordless-auth-nextjs/components/passwordless-login-form'\n\nexport default function PasswordlessLoginPage() {\n  return (\n    <div className=\"flex min-h-svh w-full items-center justify-center p-6 md:p-10\">\n      <div className=\"w-full max-w-sm\">\n        <PasswordlessLoginForm />\n      </div>\n    </div>\n  )\n}\n",
      "type": "registry:page",
      "target": "app/auth/passwordless/page.tsx"
    },
    {
      "path": "registry/default/blocks/passwordless-auth-nextjs/app/auth/confirm/route.ts",
      "content": "import { createClient } from '@/registry/default/clients/nextjs/lib/supabase/server'\nimport { type EmailOtpType } from '@supabase/supabase-js'\nimport { type NextRequest, NextResponse } from 'next/server'\n\nexport async function GET(request: NextRequest) {\n  const { searchParams } = new URL(request.url)\n  const token_hash = searchParams.get('token_hash')\n  const type = searchParams.get('type') as EmailOtpType | null\n  const next = searchParams.get('next') ?? '/protected'\n\n  if (token_hash && type) {\n    const supabase = await createClient()\n\n    const { error } = await supabase.auth.verifyOtp({\n      type,\n      token_hash,\n    })\n    if (!error) {\n      // Redirect user to specified redirect URL or default to protected page\n      return NextResponse.redirect(new URL(next, request.url))\n    }\n  }\n\n  // Redirect the user to an error page with some instructions\n  return NextResponse.redirect(new URL('/auth/error', request.url))\n}\n",
      "type": "registry:page",
      "target": "app/auth/confirm/route.ts"
    },
    {
      "path": "registry/default/blocks/passwordless-auth-nextjs/app/auth/error/page.tsx",
      "content": "import {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/registry/default/components/ui/card'\nimport { Button } from '@/registry/default/components/ui/button'\nimport Link from 'next/link'\n\nexport default function AuthErrorPage() {\n  return (\n    <div className=\"flex min-h-svh w-full items-center justify-center p-6 md:p-10\">\n      <div className=\"w-full max-w-sm\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-2xl\">Authentication Error</CardTitle>\n            <CardDescription>There was an error authenticating your account</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-col gap-4\">\n              <p className=\"text-sm text-muted-foreground\">\n                The authentication link may have expired or is invalid. Please try requesting a new\n                one.\n              </p>\n              <Button asChild className=\"w-full\">\n                <Link href=\"/auth/passwordless\">Try again</Link>\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  )\n}\n",
      "type": "registry:page",
      "target": "app/auth/error/page.tsx"
    },
    {
      "path": "registry/default/blocks/passwordless-auth-nextjs/app/protected/page.tsx",
      "content": "import { createClient } from '@/registry/default/clients/nextjs/lib/supabase/server'\nimport { redirect } from 'next/navigation'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardHeader,\n  CardTitle,\n} from '@/registry/default/components/ui/card'\nimport { Button } from '@/registry/default/components/ui/button'\n\nexport default async function ProtectedPage() {\n  const supabase = await createClient()\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  if (!user) {\n    redirect('/auth/passwordless')\n  }\n\n  const handleSignOut = async () => {\n    'use server'\n    const supabase = await createClient()\n    await supabase.auth.signOut()\n    redirect('/auth/passwordless')\n  }\n\n  return (\n    <div className=\"flex min-h-svh w-full items-center justify-center p-6 md:p-10\">\n      <div className=\"w-full max-w-sm\">\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-2xl\">Protected Page</CardTitle>\n            <CardDescription>You are logged in</CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"flex flex-col gap-4\">\n              <div className=\"rounded-lg border p-4\">\n                <p className=\"text-sm font-medium\">Email</p>\n                <p className=\"text-sm text-muted-foreground\">{user.email}</p>\n              </div>\n              <div className=\"rounded-lg border p-4\">\n                <p className=\"text-sm font-medium\">User ID</p>\n                <p className=\"text-sm text-muted-foreground\">{user.id}</p>\n              </div>\n              <form action={handleSignOut}>\n                <Button type=\"submit\" variant=\"outline\" className=\"w-full\">\n                  Sign out\n                </Button>\n              </form>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  )\n}\n",
      "type": "registry:page",
      "target": "app/protected/page.tsx"
    },
    {
      "path": "registry/default/blocks/passwordless-auth-nextjs/middleware.ts",
      "content": "import { createServerClient } from '@supabase/ssr'\nimport { NextResponse, type NextRequest } from 'next/server'\n\nexport async function middleware(request: NextRequest) {\n  let supabaseResponse = NextResponse.next({\n    request,\n  })\n\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll()\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value, options }) => request.cookies.set(name, value))\n          supabaseResponse = NextResponse.next({\n            request,\n          })\n          cookiesToSet.forEach(({ name, value, options }) =>\n            supabaseResponse.cookies.set(name, value, options)\n          )\n        },\n      },\n    }\n  )\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  // Protect /protected route\n  if (request.nextUrl.pathname.startsWith('/protected') && !user) {\n    const url = request.nextUrl.clone()\n    url.pathname = '/auth/passwordless'\n    return NextResponse.redirect(url)\n  }\n\n  return supabaseResponse\n}\n\nexport const config = {\n  matcher: ['/((?!_next/static|_next/image|favicon.ico|.*\\\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)'],\n}\n",
      "type": "registry:file",
      "target": "middleware.ts"
    },
    {
      "path": "registry/default/clients/nextjs/lib/supabase/client.ts",
      "content": "import { createBrowserClient } from '@supabase/ssr'\n\nexport function createClient() {\n  return createBrowserClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_OR_ANON_KEY!\n  )\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "registry/default/clients/nextjs/lib/supabase/middleware.ts",
      "content": "import { createServerClient } from '@supabase/ssr'\nimport { NextResponse, type NextRequest } from 'next/server'\n\nexport async function updateSession(request: NextRequest) {\n  let supabaseResponse = NextResponse.next({\n    request,\n  })\n\n  // With Fluid compute, don't put this client in a global environment\n  // variable. Always create a new one on each request.\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_OR_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll()\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value }) => request.cookies.set(name, value))\n          supabaseResponse = NextResponse.next({\n            request,\n          })\n          cookiesToSet.forEach(({ name, value, options }) =>\n            supabaseResponse.cookies.set(name, value, options)\n          )\n        },\n      },\n    }\n  )\n\n  // Do not run code between createServerClient and\n  // supabase.auth.getClaims(). A simple mistake could make it very hard to debug\n  // issues with users being randomly logged out.\n\n  // IMPORTANT: If you remove getClaims() and you use server-side rendering\n  // with the Supabase client, your users may be randomly logged out.\n  const { data } = await supabase.auth.getClaims()\n  const user = data?.claims\n\n  if (\n    !user &&\n    !request.nextUrl.pathname.startsWith('/login') &&\n    !request.nextUrl.pathname.startsWith('/auth')\n  ) {\n    // no user, potentially respond by redirecting the user to the login page\n    const url = request.nextUrl.clone()\n    url.pathname = '/auth/login'\n    return NextResponse.redirect(url)\n  }\n\n  // IMPORTANT: You *must* return the supabaseResponse object as it is.\n  // If you're creating a new response object with NextResponse.next() make sure to:\n  // 1. Pass the request in it, like so:\n  //    const myNewResponse = NextResponse.next({ request })\n  // 2. Copy over the cookies, like so:\n  //    myNewResponse.cookies.setAll(supabaseResponse.cookies.getAll())\n  // 3. Change the myNewResponse object to fit your needs, but avoid changing\n  //    the cookies!\n  // 4. Finally:\n  //    return myNewResponse\n  // If this is not done, you may be causing the browser and server to go out\n  // of sync and terminate the user's session prematurely!\n\n  return supabaseResponse\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "registry/default/clients/nextjs/lib/supabase/server.ts",
      "content": "import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\n/**\n * If using Fluid compute: Don't put this client in a global variable. Always create a new client within each\n * function when using it.\n */\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_OR_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n",
      "type": "registry:lib"
    }
  ],
  "envVars": {
    "NEXT_PUBLIC_SUPABASE_URL": "",
    "NEXT_PUBLIC_SUPABASE_PUBLISHABLE_OR_ANON_KEY": ""
  },
  "docs": "You'll need to set the following environment variables in your project: `NEXT_PUBLIC_SUPABASE_URL` and `NEXT_PUBLIC_SUPABASE_PUBLISHABLE_OR_ANON_KEY`."
}