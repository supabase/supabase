{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "oauth-consent-nextjs",
  "type": "registry:block",
  "title": "OAuth Consent Page for Next.js and Supabase",
  "description": "OAuth 2.1 consent page for MCP server authorization with Supabase Auth",
  "dependencies": [
    "@supabase/ssr@latest",
    "@supabase/supabase-js@latest"
  ],
  "registryDependencies": [
    "button",
    "card"
  ],
  "files": [
    {
      "path": "registry/default/blocks/oauth-consent-nextjs/app/oauth/consent/page.tsx",
      "content": "import { ConsentForm } from '@/registry/default/blocks/oauth-consent-nextjs/components/consent-form'\nimport { Suspense } from 'react'\n\nfunction ConsentPageFallback() {\n  return (\n    <div className=\"flex min-h-svh w-full items-center justify-center p-6 md:p-10\">\n      <div className=\"w-full max-w-md\">\n        <div className=\"flex flex-col items-center gap-4 rounded-lg border bg-card p-6 text-card-foreground shadow-sm\">\n          <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-muted border-t-primary\" />\n          <p className=\"text-sm text-muted-foreground\">Loading...</p>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default function Page() {\n  return (\n    <div className=\"flex min-h-svh w-full items-center justify-center p-6 md:p-10\">\n      <div className=\"w-full max-w-md\">\n        <Suspense fallback={<ConsentPageFallback />}>\n          <ConsentForm />\n        </Suspense>\n      </div>\n    </div>\n  )\n}\n",
      "type": "registry:page",
      "target": "app/oauth/consent/page.tsx"
    },
    {
      "path": "registry/default/blocks/oauth-consent-nextjs/components/consent-form.tsx",
      "content": "'use client'\n\nimport { cn } from '@/lib/utils'\nimport { createClient } from '@/registry/default/clients/nextjs/lib/supabase/client'\nimport { Button } from '@/registry/default/components/ui/button'\nimport {\n  Card,\n  CardContent,\n  CardDescription,\n  CardFooter,\n  CardHeader,\n  CardTitle,\n} from '@/registry/default/components/ui/card'\nimport { useSearchParams } from 'next/navigation'\nimport { useEffect, useState } from 'react'\nimport { ScopeList } from './scope-list'\n\ninterface AuthorizationDetails {\n  client?: {\n    client_id?: string\n    client_name?: string\n    logo_uri?: string\n  }\n  scopes?: string[]\n  redirect_uri?: string\n}\n\nexport function ConsentForm({ className, ...props }: React.ComponentPropsWithoutRef<'div'>) {\n  const searchParams = useSearchParams()\n  const authorizationId = searchParams.get('authorization_id')\n\n  const [loading, setLoading] = useState(true)\n  const [error, setError] = useState<string | null>(null)\n  const [authDetails, setAuthDetails] = useState<AuthorizationDetails | null>(null)\n  const [user, setUser] = useState<{ email?: string } | null>(null)\n  const [submitting, setSubmitting] = useState(false)\n\n  useEffect(() => {\n    async function init() {\n      if (!authorizationId) {\n        setError('Missing authorization_id parameter')\n        setLoading(false)\n        return\n      }\n\n      const supabase = createClient()\n\n      try {\n        // Check if user is logged in\n        const {\n          data: { session },\n        } = await supabase.auth.getSession()\n\n        if (!session) {\n          // User not logged in - redirect to OAuth provider, then back here\n          const currentUrl = window.location.href\n          const { error } = await supabase.auth.signInWithOAuth({\n            provider: 'github', // Change this to your preferred provider\n            options: {\n              redirectTo: currentUrl,\n            },\n          })\n          if (error) throw error\n          return\n        }\n\n        setUser({ email: session.user.email })\n\n        // Get authorization details from Supabase\n        const { data, error: authError } =\n          await supabase.auth.oauth.getAuthorizationDetails(authorizationId)\n\n        if (authError) {\n          throw authError\n        }\n\n        setAuthDetails(data as unknown as AuthorizationDetails)\n      } catch (err) {\n        console.error('Error initializing consent page:', err)\n        setError(err instanceof Error ? err.message : 'Failed to load authorization details')\n      } finally {\n        setLoading(false)\n      }\n    }\n\n    init()\n  }, [authorizationId])\n\n  const handleAllow = async () => {\n    if (!authorizationId) return\n\n    const supabase = createClient()\n    setSubmitting(true)\n    try {\n      const { error } = await supabase.auth.oauth.approveAuthorization(authorizationId)\n      if (error) throw error\n      // Supabase will handle the redirect automatically\n    } catch (err) {\n      console.error('Error approving authorization:', err)\n      setError(err instanceof Error ? err.message : 'Failed to approve authorization')\n      setSubmitting(false)\n    }\n  }\n\n  const handleDeny = async () => {\n    if (!authorizationId) return\n\n    const supabase = createClient()\n    setSubmitting(true)\n    try {\n      const { error } = await supabase.auth.oauth.denyAuthorization(authorizationId)\n      if (error) throw error\n      // Supabase will handle the redirect automatically\n    } catch (err) {\n      console.error('Error denying authorization:', err)\n      setError(err instanceof Error ? err.message : 'Failed to deny authorization')\n      setSubmitting(false)\n    }\n  }\n\n  if (loading) {\n    return (\n      <div className={cn('flex flex-col gap-6', className)} {...props}>\n        <Card>\n          <CardContent className=\"pt-6\">\n            <div className=\"flex flex-col items-center gap-4\">\n              <div className=\"h-8 w-8 animate-spin rounded-full border-4 border-muted border-t-primary\" />\n              <p className=\"text-sm text-muted-foreground\">Loading authorization details...</p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  if (error) {\n    return (\n      <div className={cn('flex flex-col gap-6', className)} {...props}>\n        <Card>\n          <CardHeader>\n            <CardTitle className=\"text-2xl\">Authorization Error</CardTitle>\n          </CardHeader>\n          <CardContent>\n            <p className=\"text-sm text-destructive\">{error}</p>\n          </CardContent>\n        </Card>\n      </div>\n    )\n  }\n\n  const clientName =\n    authDetails?.client?.client_name || authDetails?.client?.client_id || 'Unknown Application'\n  const scopes = authDetails?.scopes || []\n\n  return (\n    <div className={cn('flex flex-col gap-6', className)} {...props}>\n      <Card>\n        <CardHeader>\n          <CardTitle className=\"text-2xl\">Authorize Application</CardTitle>\n          <CardDescription className=\"break-all\">{clientName}</CardDescription>\n          {user?.email && (\n            <p className=\"text-xs text-muted-foreground\">Logged in as {user.email}</p>\n          )}\n        </CardHeader>\n        <CardContent>\n          <div className=\"rounded-lg bg-muted p-4\">\n            <p className=\"mb-3 text-sm font-medium\">This application is requesting access to:</p>\n            <ScopeList scopes={scopes} />\n          </div>\n        </CardContent>\n        <CardFooter className=\"flex gap-3\">\n          <Button variant=\"outline\" className=\"flex-1\" onClick={handleDeny} disabled={submitting}>\n            {submitting ? '...' : 'Deny'}\n          </Button>\n          <Button className=\"flex-1\" onClick={handleAllow} disabled={submitting}>\n            {submitting ? '...' : 'Allow'}\n          </Button>\n        </CardFooter>\n      </Card>\n    </div>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/blocks/oauth-consent-nextjs/components/scope-list.tsx",
      "content": "'use client'\n\nimport { CheckCircle2 } from 'lucide-react'\n\ninterface ScopeListProps {\n  scopes: string[]\n}\n\nexport function ScopeList({ scopes }: ScopeListProps) {\n  const displayScopes =\n    scopes.length > 0 ? scopes : ['Access your account information', 'Use MCP tools on your behalf']\n\n  return (\n    <ul className=\"space-y-2\">\n      {displayScopes.map((scope) => (\n        <li key={scope} className=\"flex items-center gap-2 text-sm\">\n          <CheckCircle2 className=\"h-4 w-4 text-green-500 flex-shrink-0\" />\n          <span>{scope}</span>\n        </li>\n      ))}\n    </ul>\n  )\n}\n",
      "type": "registry:component"
    },
    {
      "path": "registry/default/clients/nextjs/lib/supabase/client.ts",
      "content": "import { createBrowserClient } from '@supabase/ssr'\n\nexport function createClient() {\n  return createBrowserClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_OR_ANON_KEY!\n  )\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "registry/default/clients/nextjs/lib/supabase/middleware.ts",
      "content": "import { createServerClient } from '@supabase/ssr'\nimport { NextResponse, type NextRequest } from 'next/server'\n\nexport async function updateSession(request: NextRequest) {\n  let supabaseResponse = NextResponse.next({\n    request,\n  })\n\n  // With Fluid compute, don't put this client in a global environment\n  // variable. Always create a new one on each request.\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_OR_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll()\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value }) => request.cookies.set(name, value))\n          supabaseResponse = NextResponse.next({\n            request,\n          })\n          cookiesToSet.forEach(({ name, value, options }) =>\n            supabaseResponse.cookies.set(name, value, options)\n          )\n        },\n      },\n    }\n  )\n\n  // Do not run code between createServerClient and\n  // supabase.auth.getClaims(). A simple mistake could make it very hard to debug\n  // issues with users being randomly logged out.\n\n  // IMPORTANT: If you remove getClaims() and you use server-side rendering\n  // with the Supabase client, your users may be randomly logged out.\n  const { data } = await supabase.auth.getClaims()\n  const user = data?.claims\n\n  if (\n    !user &&\n    !request.nextUrl.pathname.startsWith('/login') &&\n    !request.nextUrl.pathname.startsWith('/auth')\n  ) {\n    // no user, potentially respond by redirecting the user to the login page\n    const url = request.nextUrl.clone()\n    url.pathname = '/auth/login'\n    return NextResponse.redirect(url)\n  }\n\n  // IMPORTANT: You *must* return the supabaseResponse object as it is.\n  // If you're creating a new response object with NextResponse.next() make sure to:\n  // 1. Pass the request in it, like so:\n  //    const myNewResponse = NextResponse.next({ request })\n  // 2. Copy over the cookies, like so:\n  //    myNewResponse.cookies.setAll(supabaseResponse.cookies.getAll())\n  // 3. Change the myNewResponse object to fit your needs, but avoid changing\n  //    the cookies!\n  // 4. Finally:\n  //    return myNewResponse\n  // If this is not done, you may be causing the browser and server to go out\n  // of sync and terminate the user's session prematurely!\n\n  return supabaseResponse\n}\n",
      "type": "registry:lib"
    },
    {
      "path": "registry/default/clients/nextjs/lib/supabase/server.ts",
      "content": "import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\n\n/**\n * If using Fluid compute: Don't put this client in a global variable. Always create a new client within each\n * function when using it.\n */\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_OR_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch {\n            // The `setAll` method was called from a Server Component.\n            // This can be ignored if you have middleware refreshing\n            // user sessions.\n          }\n        },\n      },\n    }\n  )\n}\n",
      "type": "registry:lib"
    }
  ],
  "envVars": {
    "NEXT_PUBLIC_SUPABASE_URL": "",
    "NEXT_PUBLIC_SUPABASE_PUBLISHABLE_OR_ANON_KEY": ""
  },
  "docs": "You'll need to set the following environment variables in your project: `NEXT_PUBLIC_SUPABASE_URL` and `NEXT_PUBLIC_SUPABASE_PUBLISHABLE_OR_ANON_KEY`."
}