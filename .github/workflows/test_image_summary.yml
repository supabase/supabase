name: Test Image Summary

on:
  workflow_dispatch:
  push:
    branches:
      - feat/image-summary

jobs:
  test_summary:
    runs-on: blacksmith-4vcpu-ubuntu-2404
    steps:
      - name: Generate test image version
        id: version
        run: |
          # Simulated image version
          DATE=$(date +%Y.%m.%d)
          SHA=$(echo ${{ github.sha }} | cut -c1-7)
          VERSION="${DATE}-sha-${SHA}"
          echo "version=${VERSION}" >> $GITHUB_OUTPUT

      - name: Create job summary
        run: |
          echo '# Published Docker Images' >> $GITHUB_STEP_SUMMARY
          echo '' >> $GITHUB_STEP_SUMMARY
          echo '- \`supabase/studio:${{ steps.version.outputs.version }}\` ([Docker Hub](https://hub.docker.com/r/supabase/studio/tags?name=${{ steps.version.outputs.version }}))' >> $GITHUB_STEP_SUMMARY
          echo '- \`supabase/studio:latest\` ([Docker Hub](https://hub.docker.com/r/supabase/studio/tags?name=latest))' >> $GITHUB_STEP_SUMMARY
